## **随机数生成心得**

C 语言的标准库提供了一套“伪随机数生成器”（Pseudo-Random Number Generator, PRNG）。说它是“伪随机”是因为它生成的序列是通过一个确定的算法计算出来的，看起来随机，但实际上是可预测的。只要算法和初始条件（种子）相同，生成的序列就完全一样。

生成随机数通常需要三步：**设置种子** -\> **生成随机数** -\> **格式化到指定范围**。这主要涉及到两个函数：`srand()` 和 `rand()`，它们都在 `<stdlib.h>` 头文件中。

-----

### **第一步：设置随机数种子 `srand()`**

`srand()` 函数用于“播种”随机数生成器。你可以把它想象成给随机数算法提供一个起始点。如果起始点相同，那么后续生成的整个随机数序列也都会完全相同。

**函数原型**：

```c
void srand(unsigned int seed);
```

  * `seed`：一个无符号整数，就是我们所说的“种子”。

**问题**：如果每次程序运行时我们都用一个固定的种子，比如 `srand(1)`，那么每次程序生成的“随机数”序列都会一模一样。这在调试时很有用，但在实际应用中我们希望每次都不同。

**解决方案**：使用一个每次程序运行时都在变化的值作为种子。最理想、最常用的就是**当前时间**。

我们可以用 `<time.h>` 头文件中的 `time()` 函数来获取当前时间。

  * `time(NULL)`：这个表达式会返回从 UTC 1970年1月1日 0点 到现在的总秒数。这个值在每一秒都是不同的。

**所以，初始化随机数种子的标准做法是**：

```c
#include <stdlib.h>
#include <time.h>

// 将这行代码放在程序的开始部分，且整个程序只需执行一次！
srand((unsigned int)time(NULL)); 
```

  * **注意**：`time()` 返回的是 `time_t` 类型，而 `srand()` 需要 `unsigned int` 类型，所以我们在这里做了一个**类型强制转换 `(unsigned int)`**，这是标准且安全的做法。
  * **极其重要**：`srand()` **只需要在程序启动时调用一次**，通常是在 `main` 函数的开头。绝对不要把它放在一个循环里面！如果在循环里反复用 `time(NULL)` 做种子，因为计算机执行速度很快，在一秒内 `time(NULL)` 的返回值是相同的，会导致你在这一秒内生成的随机数全都一样。

-----

### **第二步：生成随机数 `rand()`**

一旦种子设置好了，就可以调用 `rand()` 函数来获取一个随机数。

**函数原型**：

```c
int rand(void);
```

  * 该函数不需要参数。
  * 它会返回一个 `0` 到 `RAND_MAX` 之间的伪随机整数。
  * `RAND_MAX` 是一个在 `<stdlib.h>` 中定义的常量，它代表了 `rand()` 能生成的最大值。在不同的系统上这个值可能不同，但标准规定它至少是 32767。

<!-- end list -->

```c
int random_number = rand(); // random_number 的值会在 0 到 RAND_MAX 之间
```

-----

### **第三步：将随机数格式化到指定范围**

通常我们不想要一个 0 到 32767 之间的数，而是需要一个特定范围的数，比如掷骰子的 1 到 6，或者抽奖的 1 到 100。这可以通过**取模运算符 `%`** 和**加法**来实现。

#### **通用公式**

要生成一个 `[min, max]` 区间内的随机整数（包含 `min` 和 `max`），可以使用以下公式：

`rand() % (max - min + 1) + min`

**公式分解**：

1.  `max - min + 1`：计算出这个区间内总共有多少个可能的整数。例如，`[1, 6]` 区间有 `6 - 1 + 1 = 6` 个数。
2.  `rand() % ( ... )`：`rand()` 生成的数对这个总数取模，得到的结果范围是 `[0, max - min]`。例如，`rand() % 6` 的结果是 `0, 1, 2, 3, 4, 5` 中的一个。
3.  `... + min`：将上一步的结果加上区间的最小值 `min`，就将 `[0, max - min]` 这个范围整体“平移”到了 `[min, max]`。例如，将 `0` 到 `5` 的结果加上 `1`，就得到了 `1` 到 `6` 的范围。

#### **常见示例**

  * **生成 `0` 到 `99` 之间的随机数 (共100个数)**：
    ```c
    int r = rand() % 100;
    ```
  * **生成 `1` 到 `100` 之间的随机数**：
    ```c
    // min = 1, max = 100
    // (100 - 1 + 1) = 100
    int r = rand() % 100 + 1;
    ```
  * **模拟掷骰子 (生成 `1` 到 `6` 之间的随机数)**：
    ```c
    // min = 1, max = 6
    // (6 - 1 + 1) = 6
    int dice_roll = rand() % 6 + 1;
    ```

-----

### **完整代码示例**

下面的程序会生成 5 个 1 到 100 之间的随机数。

```c
#include <stdio.h>
#include <stdlib.h> // for rand() and srand()
#include <time.h>   // for time()

int main() {
    // 1. 设置随机数种子（整个程序只做一次）
    srand((unsigned int)time(NULL));
    printf("已使用当前时间设置随机数种子。\n");

    int min = 1;
    int max = 100;
    
    printf("正在生成 5 个在 [%d, %d] 范围内的随机数:\n", min, max);

    for (int i = 0; i < 5; i++) {
        // 2. 生成随机数
        // 3. 格式化到指定范围
        int random_num = rand() % (max - min + 1) + min;
        printf("第 %d 个随机数: %d\n", i + 1, random_num);
    }

    return 0;
}
```

如果你多次运行这个程序，会发现每次生成的 5 个数字组合都是不同的。但如果你把 `srand(...)` 那一行注释掉，那么每次运行的结果都会完全一样。